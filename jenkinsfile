node {
    
    stage('build') {
       checkout scm
       sh '''mvn clean install'''
    }

    stage('test'){
        sh ''' mvn -X livingdoc:freeze -Dlivingdoc.document.repository.base.url="http://localhost:2020/confluence/rpc/xmlrpc?handler=livingdoc1&amp;sut=CI&amp;includeStyle=true&amp;implemented=true#LD" '''

       timeout(5){
            try{
                sh ''' mvn -X livingdoc:run '''
            }catch(err){
                echo "Error executing tests: ${err}"
            }
        }
    }

    stage('report'){
        livingdoc confluenceConfig: [confluenceSiteTitle: 'AQE Showcase Confluence', confluenceSpaceKey: 'LD', confluenceUrl: 'http://localhost:2020/confluence', sut: 'CI'], failureThreshold: 50, testResultsPattern: '**/livingdoc-reports/**'
    }

    stage('publish'){
        sh 'rm -r /var/aat-remote/classpath'
        sh 'mkdir /var/aat-remote/classpath'
        sh 'cp -R target/libs/ /var/aat-remote/classpath'
        sh 'cp target/*.jar  /var/aat-remote/classpath/libs'
    }
}